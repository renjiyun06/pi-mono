# Known Issues

## One-shot 任务的上下文压缩策略不合理

**问题**：当前 compact 机制按"保留尾部 keepRecentTokens，压缩前面所有"的策略运作。这对交互式会话合理，但对 one-shot 任务（如 zhihu-discover）来说是反的——任务 prompt 和记忆文件在最开头，是最重要的内容，却最先被压缩掉。而中间大量已完成的浏览器截图等操作过程其实毫无保留价值。

**场景**：浏览器类任务执行过程中，反复截图导致上下文膨胀，触发 auto compaction 后，开头的任务指令和约束被压缩成摘要，agent 后续行为可能偏离。

**初步策略**：三段式上下文管理：
- **固定区**（头部）：任务 prompt + 记忆文件，永远不压缩
- **可压缩区**（中间）：已完成的操作过程，随时可丢弃或压缩
- **活跃区**（尾部）：当前正在做的步骤，保留

这与现有 compact 机制的改动点主要在于：需要标记哪些消息属于"固定区"不参与压缩，压缩时只处理中间部分。
